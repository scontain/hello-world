This is a demonstration of _sconification_ process for C,C++,Go and Java languages.

The entry point could be considered `start.sh` script that does everything:
1) Build native image from provided Dockerfile
2) Sconifies native image and adds to it FSFP or binaryFS.
3) Runs all native and sconified images.

An important file is `/sconification/evn.sh`. It holds the names of all the images that are either used for _sconification_ or
will be created during this process.

All languages have associated folders in `image` folder.

Sconification is done by the script `/sconification/sconify_all.sh`.
This script contains separate functions that are responsible for the sconification of one language and one type of file system.

For example, the following function is responsible for the sconification of Go+FSPF.
```
function go_image_fspf(){
    echo "Making GO with fspf"
    SCONE_HEAP=2G

    export NAMESPACE="sconify-ns-$RANDOM$RANDOM$RANDOM$RANDOM"
    export SESSION=$(
    sconify_image \
            --create-namespace \                                <= Here we request creation of namespace on CAS
            --namespace=$NAMESPACE \                            <= Name of our namespace
            --name=$GO_SESSION_NAME \                           <= Name of the session within our namespace
            --from=$GO_NATIVE_IMAGE \                           <= Tag of native image
            --to=$GO_TARGET_IMAGE_FSPF \                        <= Tag of sconified image
            --cas=$SCONE_CAS_ADDR_L \                           <= CAS address (will be embedded in image as ENV)
            --las=$SCONE_LAS_ADDR_L \                           <= LAS address (will be embedded in image as ENV)
            --cli=$CLI_IMAGE \                                  <= SCONE image that has CLI tool (internal use by sconify_image)
            --crosscompiler=$CROSSCOMPILER_IMAGE \              <= SCONE image that has crosscompiler tool (internal use by sconify_image)
            --cas-debug \                                       <= We attest cas in debug mode
            --binary=$GO_BINARY \                               <= Binary within image that we wish to sconify
            --dir=/app \                                        <= Directory that we wish to include in FSPF (encryption+integrity protection)
            --heap=$SCONE_HEAP \                                <= Heap size (will be use by SCONE signer)
            --stack=$SCONE_STACK \                              <= Stack size (will be use by SCONE signer)
            --dlopen=$SCONE_ALLOW_DLOPEN \                      <= Permission for library loading size (will be use by SCONE signer)
            --command="${GO_BINARY} -session -added -this" \    <= Command that will be executed by our container
            --env="ID=FSFP" \                                   <= Adding env variable to our session
            --no-color                                          <= Print without color
        )
    
    echo "Done making GO with fspf"
}
```
If you wish to check the other options of `sconify_image`, you could run:
```
docker run -it --rm -v /var/run/docker.sock:/var/run/docker.sock registry.scontain.com:5050/sconecuratedimages/iexec-sconify-image:5.3.1
```
As a result of sconification we obtain $GO_TARGET_IMAGE_FSPF image that we run with docker-compose.
```
docker-compose run go_scone_fspf
```

In `docker-compose.yml`, the above service corresponds to:
```
    go_scone_fspf:
        image: ${GO_TARGET_IMAGE_FSPF}
        environment:
         - SCONE_VERSION=1
        devices:
         - "/dev/isgx"
        depends_on:
            - las
            - cas
```

And if everything went smoothly, you will see output similar to this one:
```
export SCONE_QUEUES=4
export SCONE_SLOTS=256
export SCONE_SIGPIPE=0
export SCONE_MMAP32BIT=0
export SCONE_SSPINS=100
export SCONE_SSLEEP=4000
export SCONE_TCS=8
export SCONE_LOG=WARNING
export SCONE_HEAP=2147483648
export SCONE_STACK=4194304
export SCONE_CONFIG=autogenerated
export SCONE_ESPINS=10000
export SCONE_MODE=hw
export SCONE_ALLOW_DLOPEN=yes (unprotected)
export SCONE_MPROTECT=no
export SCONE_FORK=no
musl version: 1.1.24
SCONE version: 5.2.1-42-gea2f241e0-robert/ee-sconify-image (Wed Mar 31 17:10:38 2021 +0000) (repository state: dirty)
Enclave hash: 4cf88e47762a76990a44314669379e6064d0ada05d6b992731b60e991a70895d
.....Some warnings were cut out.....
ID of thi program is: FSFP
My args are: 
[/app/print-secret-message -session -added -this]
Go secretly say Hello Scone!
```

Happy Sconification!
